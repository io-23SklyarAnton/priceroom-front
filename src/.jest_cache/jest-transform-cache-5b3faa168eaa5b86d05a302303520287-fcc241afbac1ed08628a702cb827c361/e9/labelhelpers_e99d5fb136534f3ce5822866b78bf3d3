2068df97a3ca93f4abcafdc68aad268a
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getLabelContent = getLabelContent;
exports.getLabels = getLabels;
exports.getRealLabels = getRealLabels;
var _helpers = require("./helpers");
var labelledNodeNames = ['button', 'meter', 'output', 'progress', 'select', 'textarea', 'input'];
function getTextContent(node) {
  if (labelledNodeNames.includes(node.nodeName.toLowerCase())) {
    return '';
  }
  if (node.nodeType === _helpers.TEXT_NODE) return node.textContent;
  return Array.from(node.childNodes).map(function (childNode) {
    return getTextContent(childNode);
  }).join('');
}
function getLabelContent(element) {
  var textContent;
  if (element.tagName.toLowerCase() === 'label') {
    textContent = getTextContent(element);
  } else {
    textContent = element.value || element.textContent;
  }
  return textContent;
}

// Based on https://github.com/eps1lon/dom-accessibility-api/pull/352
function getRealLabels(element) {
  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition -- types are not aware of older browsers that don't implement `labels`
  if (element.labels !== undefined) {
    var _element$labels;
    return (_element$labels = element.labels) !== null && _element$labels !== void 0 ? _element$labels : [];
  }
  if (!isLabelable(element)) return [];
  var labels = element.ownerDocument.querySelectorAll('label');
  return Array.from(labels).filter(function (label) {
    return label.control === element;
  });
}
function isLabelable(element) {
  return /BUTTON|METER|OUTPUT|PROGRESS|SELECT|TEXTAREA/.test(element.tagName) || element.tagName === 'INPUT' && element.getAttribute('type') !== 'hidden';
}
function getLabels(container, element) {
  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
    _ref$selector = _ref.selector,
    selector = _ref$selector === void 0 ? '*' : _ref$selector;
  var ariaLabelledBy = element.getAttribute('aria-labelledby');
  var labelsId = ariaLabelledBy ? ariaLabelledBy.split(' ') : [];
  return labelsId.length ? labelsId.map(function (labelId) {
    var labellingElement = container.querySelector("[id=\"".concat(labelId, "\"]"));
    return labellingElement ? {
      content: getLabelContent(labellingElement),
      formControl: null
    } : {
      content: '',
      formControl: null
    };
  }) : Array.from(getRealLabels(element)).map(function (label) {
    var textToMatch = getLabelContent(label);
    var formControlSelector = 'button, input, meter, output, progress, select, textarea';
    var labelledFormControl = Array.from(label.querySelectorAll(formControlSelector)).filter(function (formControlElement) {
      return formControlElement.matches(selector);
    })[0];
    return {
      content: textToMatch,
      formControl: labelledFormControl
    };
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImdldExhYmVsQ29udGVudCIsImdldExhYmVscyIsImdldFJlYWxMYWJlbHMiLCJfaGVscGVycyIsInJlcXVpcmUiLCJsYWJlbGxlZE5vZGVOYW1lcyIsImdldFRleHRDb250ZW50Iiwibm9kZSIsImluY2x1ZGVzIiwibm9kZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsIm5vZGVUeXBlIiwiVEVYVF9OT0RFIiwidGV4dENvbnRlbnQiLCJBcnJheSIsImZyb20iLCJjaGlsZE5vZGVzIiwibWFwIiwiY2hpbGROb2RlIiwiam9pbiIsImVsZW1lbnQiLCJ0YWdOYW1lIiwibGFiZWxzIiwidW5kZWZpbmVkIiwiX2VsZW1lbnQkbGFiZWxzIiwiaXNMYWJlbGFibGUiLCJvd25lckRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZpbHRlciIsImxhYmVsIiwiY29udHJvbCIsInRlc3QiLCJnZXRBdHRyaWJ1dGUiLCJjb250YWluZXIiLCJfcmVmIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiX3JlZiRzZWxlY3RvciIsInNlbGVjdG9yIiwiYXJpYUxhYmVsbGVkQnkiLCJsYWJlbHNJZCIsInNwbGl0IiwibGFiZWxJZCIsImxhYmVsbGluZ0VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29uY2F0IiwiY29udGVudCIsImZvcm1Db250cm9sIiwidGV4dFRvTWF0Y2giLCJmb3JtQ29udHJvbFNlbGVjdG9yIiwibGFiZWxsZWRGb3JtQ29udHJvbCIsImZvcm1Db250cm9sRWxlbWVudCIsIm1hdGNoZXMiXSwic291cmNlcyI6WyJsYWJlbC1oZWxwZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5nZXRMYWJlbENvbnRlbnQgPSBnZXRMYWJlbENvbnRlbnQ7XG5leHBvcnRzLmdldExhYmVscyA9IGdldExhYmVscztcbmV4cG9ydHMuZ2V0UmVhbExhYmVscyA9IGdldFJlYWxMYWJlbHM7XG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi9oZWxwZXJzXCIpO1xuY29uc3QgbGFiZWxsZWROb2RlTmFtZXMgPSBbJ2J1dHRvbicsICdtZXRlcicsICdvdXRwdXQnLCAncHJvZ3Jlc3MnLCAnc2VsZWN0JywgJ3RleHRhcmVhJywgJ2lucHV0J107XG5mdW5jdGlvbiBnZXRUZXh0Q29udGVudChub2RlKSB7XG4gIGlmIChsYWJlbGxlZE5vZGVOYW1lcy5pbmNsdWRlcyhub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG4gIGlmIChub2RlLm5vZGVUeXBlID09PSBfaGVscGVycy5URVhUX05PREUpIHJldHVybiBub2RlLnRleHRDb250ZW50O1xuICByZXR1cm4gQXJyYXkuZnJvbShub2RlLmNoaWxkTm9kZXMpLm1hcChjaGlsZE5vZGUgPT4gZ2V0VGV4dENvbnRlbnQoY2hpbGROb2RlKSkuam9pbignJyk7XG59XG5mdW5jdGlvbiBnZXRMYWJlbENvbnRlbnQoZWxlbWVudCkge1xuICBsZXQgdGV4dENvbnRlbnQ7XG4gIGlmIChlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2xhYmVsJykge1xuICAgIHRleHRDb250ZW50ID0gZ2V0VGV4dENvbnRlbnQoZWxlbWVudCk7XG4gIH0gZWxzZSB7XG4gICAgdGV4dENvbnRlbnQgPSBlbGVtZW50LnZhbHVlIHx8IGVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIH1cbiAgcmV0dXJuIHRleHRDb250ZW50O1xufVxuXG4vLyBCYXNlZCBvbiBodHRwczovL2dpdGh1Yi5jb20vZXBzMWxvbi9kb20tYWNjZXNzaWJpbGl0eS1hcGkvcHVsbC8zNTJcbmZ1bmN0aW9uIGdldFJlYWxMYWJlbHMoZWxlbWVudCkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVubmVjZXNzYXJ5LWNvbmRpdGlvbiAtLSB0eXBlcyBhcmUgbm90IGF3YXJlIG9mIG9sZGVyIGJyb3dzZXJzIHRoYXQgZG9uJ3QgaW1wbGVtZW50IGBsYWJlbHNgXG4gIGlmIChlbGVtZW50LmxhYmVscyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubGFiZWxzID8/IFtdO1xuICB9XG4gIGlmICghaXNMYWJlbGFibGUoZWxlbWVudCkpIHJldHVybiBbXTtcbiAgY29uc3QgbGFiZWxzID0gZWxlbWVudC5vd25lckRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xhYmVsJyk7XG4gIHJldHVybiBBcnJheS5mcm9tKGxhYmVscykuZmlsdGVyKGxhYmVsID0+IGxhYmVsLmNvbnRyb2wgPT09IGVsZW1lbnQpO1xufVxuZnVuY3Rpb24gaXNMYWJlbGFibGUoZWxlbWVudCkge1xuICByZXR1cm4gL0JVVFRPTnxNRVRFUnxPVVRQVVR8UFJPR1JFU1N8U0VMRUNUfFRFWFRBUkVBLy50ZXN0KGVsZW1lbnQudGFnTmFtZSkgfHwgZWxlbWVudC50YWdOYW1lID09PSAnSU5QVVQnICYmIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCd0eXBlJykgIT09ICdoaWRkZW4nO1xufVxuZnVuY3Rpb24gZ2V0TGFiZWxzKGNvbnRhaW5lciwgZWxlbWVudCwge1xuICBzZWxlY3RvciA9ICcqJ1xufSA9IHt9KSB7XG4gIGNvbnN0IGFyaWFMYWJlbGxlZEJ5ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWxsZWRieScpO1xuICBjb25zdCBsYWJlbHNJZCA9IGFyaWFMYWJlbGxlZEJ5ID8gYXJpYUxhYmVsbGVkQnkuc3BsaXQoJyAnKSA6IFtdO1xuICByZXR1cm4gbGFiZWxzSWQubGVuZ3RoID8gbGFiZWxzSWQubWFwKGxhYmVsSWQgPT4ge1xuICAgIGNvbnN0IGxhYmVsbGluZ0VsZW1lbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihgW2lkPVwiJHtsYWJlbElkfVwiXWApO1xuICAgIHJldHVybiBsYWJlbGxpbmdFbGVtZW50ID8ge1xuICAgICAgY29udGVudDogZ2V0TGFiZWxDb250ZW50KGxhYmVsbGluZ0VsZW1lbnQpLFxuICAgICAgZm9ybUNvbnRyb2w6IG51bGxcbiAgICB9IDoge1xuICAgICAgY29udGVudDogJycsXG4gICAgICBmb3JtQ29udHJvbDogbnVsbFxuICAgIH07XG4gIH0pIDogQXJyYXkuZnJvbShnZXRSZWFsTGFiZWxzKGVsZW1lbnQpKS5tYXAobGFiZWwgPT4ge1xuICAgIGNvbnN0IHRleHRUb01hdGNoID0gZ2V0TGFiZWxDb250ZW50KGxhYmVsKTtcbiAgICBjb25zdCBmb3JtQ29udHJvbFNlbGVjdG9yID0gJ2J1dHRvbiwgaW5wdXQsIG1ldGVyLCBvdXRwdXQsIHByb2dyZXNzLCBzZWxlY3QsIHRleHRhcmVhJztcbiAgICBjb25zdCBsYWJlbGxlZEZvcm1Db250cm9sID0gQXJyYXkuZnJvbShsYWJlbC5xdWVyeVNlbGVjdG9yQWxsKGZvcm1Db250cm9sU2VsZWN0b3IpKS5maWx0ZXIoZm9ybUNvbnRyb2xFbGVtZW50ID0+IGZvcm1Db250cm9sRWxlbWVudC5tYXRjaGVzKHNlbGVjdG9yKSlbMF07XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRlbnQ6IHRleHRUb01hdGNoLFxuICAgICAgZm9ybUNvbnRyb2w6IGxhYmVsbGVkRm9ybUNvbnRyb2xcbiAgICB9O1xuICB9KTtcbn0iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVpBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQzNDQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFDRkQsT0FBTyxDQUFDRSxlQUFlLEdBQUdBLGVBQWU7QUFDekNGLE9BQU8sQ0FBQ0csU0FBUyxHQUFHQSxTQUFTO0FBQzdCSCxPQUFPLENBQUNJLGFBQWEsR0FBR0EsYUFBYTtBQUNyQyxJQUFJQyxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDbkMsSUFBTUMsaUJBQWlCLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUM7QUFDbEcsU0FBU0MsY0FBY0EsQ0FBQ0MsSUFBSSxFQUFFO0VBQzVCLElBQUlGLGlCQUFpQixDQUFDRyxRQUFRLENBQUNELElBQUksQ0FBQ0UsUUFBUSxDQUFDQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUU7SUFDM0QsT0FBTyxFQUFFO0VBQ1g7RUFDQSxJQUFJSCxJQUFJLENBQUNJLFFBQVEsS0FBS1IsUUFBUSxDQUFDUyxTQUFTLEVBQUUsT0FBT0wsSUFBSSxDQUFDTSxXQUFXO0VBQ2pFLE9BQU9DLEtBQUssQ0FBQ0MsSUFBSSxDQUFDUixJQUFJLENBQUNTLFVBQVUsQ0FBQyxDQUFDQyxHQUFHLENBQUMsVUFBQUMsU0FBUztJQUFBLE9BQUlaLGNBQWMsQ0FBQ1ksU0FBUyxDQUFDO0VBQUEsRUFBQyxDQUFDQyxJQUFJLENBQUMsRUFBRSxDQUFDO0FBQ3pGO0FBQ0EsU0FBU25CLGVBQWVBLENBQUNvQixPQUFPLEVBQUU7RUFDaEMsSUFBSVAsV0FBVztFQUNmLElBQUlPLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDWCxXQUFXLENBQUMsQ0FBQyxLQUFLLE9BQU8sRUFBRTtJQUM3Q0csV0FBVyxHQUFHUCxjQUFjLENBQUNjLE9BQU8sQ0FBQztFQUN2QyxDQUFDLE1BQU07SUFDTFAsV0FBVyxHQUFHTyxPQUFPLENBQUNyQixLQUFLLElBQUlxQixPQUFPLENBQUNQLFdBQVc7RUFDcEQ7RUFDQSxPQUFPQSxXQUFXO0FBQ3BCOztBQUVBO0FBQ0EsU0FBU1gsYUFBYUEsQ0FBQ2tCLE9BQU8sRUFBRTtFQUM5QjtFQUNBLElBQUlBLE9BQU8sQ0FBQ0UsTUFBTSxLQUFLQyxTQUFTLEVBQUU7SUFBQSxJQUFBQyxlQUFBO0lBQ2hDLFFBQUFBLGVBQUEsR0FBT0osT0FBTyxDQUFDRSxNQUFNLGNBQUFFLGVBQUEsY0FBQUEsZUFBQSxHQUFJLEVBQUU7RUFDN0I7RUFDQSxJQUFJLENBQUNDLFdBQVcsQ0FBQ0wsT0FBTyxDQUFDLEVBQUUsT0FBTyxFQUFFO0VBQ3BDLElBQU1FLE1BQU0sR0FBR0YsT0FBTyxDQUFDTSxhQUFhLENBQUNDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztFQUM5RCxPQUFPYixLQUFLLENBQUNDLElBQUksQ0FBQ08sTUFBTSxDQUFDLENBQUNNLE1BQU0sQ0FBQyxVQUFBQyxLQUFLO0lBQUEsT0FBSUEsS0FBSyxDQUFDQyxPQUFPLEtBQUtWLE9BQU87RUFBQSxFQUFDO0FBQ3RFO0FBQ0EsU0FBU0ssV0FBV0EsQ0FBQ0wsT0FBTyxFQUFFO0VBQzVCLE9BQU8sOENBQThDLENBQUNXLElBQUksQ0FBQ1gsT0FBTyxDQUFDQyxPQUFPLENBQUMsSUFBSUQsT0FBTyxDQUFDQyxPQUFPLEtBQUssT0FBTyxJQUFJRCxPQUFPLENBQUNZLFlBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyxRQUFRO0FBQ3pKO0FBQ0EsU0FBUy9CLFNBQVNBLENBQUNnQyxTQUFTLEVBQUViLE9BQU8sRUFFN0I7RUFBQSxJQUFBYyxJQUFBLEdBQUFDLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFaLFNBQUEsR0FBQVksU0FBQSxNQUFKLENBQUMsQ0FBQztJQUFBRSxhQUFBLEdBQUFILElBQUEsQ0FESkksUUFBUTtJQUFSQSxRQUFRLEdBQUFELGFBQUEsY0FBRyxHQUFHLEdBQUFBLGFBQUE7RUFFZCxJQUFNRSxjQUFjLEdBQUduQixPQUFPLENBQUNZLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQztFQUM5RCxJQUFNUSxRQUFRLEdBQUdELGNBQWMsR0FBR0EsY0FBYyxDQUFDRSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtFQUNoRSxPQUFPRCxRQUFRLENBQUNKLE1BQU0sR0FBR0ksUUFBUSxDQUFDdkIsR0FBRyxDQUFDLFVBQUF5QixPQUFPLEVBQUk7SUFDL0MsSUFBTUMsZ0JBQWdCLEdBQUdWLFNBQVMsQ0FBQ1csYUFBYSxVQUFBQyxNQUFBLENBQVNILE9BQU8sUUFBSSxDQUFDO0lBQ3JFLE9BQU9DLGdCQUFnQixHQUFHO01BQ3hCRyxPQUFPLEVBQUU5QyxlQUFlLENBQUMyQyxnQkFBZ0IsQ0FBQztNQUMxQ0ksV0FBVyxFQUFFO0lBQ2YsQ0FBQyxHQUFHO01BQ0ZELE9BQU8sRUFBRSxFQUFFO01BQ1hDLFdBQVcsRUFBRTtJQUNmLENBQUM7RUFDSCxDQUFDLENBQUMsR0FBR2pDLEtBQUssQ0FBQ0MsSUFBSSxDQUFDYixhQUFhLENBQUNrQixPQUFPLENBQUMsQ0FBQyxDQUFDSCxHQUFHLENBQUMsVUFBQVksS0FBSyxFQUFJO0lBQ25ELElBQU1tQixXQUFXLEdBQUdoRCxlQUFlLENBQUM2QixLQUFLLENBQUM7SUFDMUMsSUFBTW9CLG1CQUFtQixHQUFHLDBEQUEwRDtJQUN0RixJQUFNQyxtQkFBbUIsR0FBR3BDLEtBQUssQ0FBQ0MsSUFBSSxDQUFDYyxLQUFLLENBQUNGLGdCQUFnQixDQUFDc0IsbUJBQW1CLENBQUMsQ0FBQyxDQUFDckIsTUFBTSxDQUFDLFVBQUF1QixrQkFBa0I7TUFBQSxPQUFJQSxrQkFBa0IsQ0FBQ0MsT0FBTyxDQUFDZCxRQUFRLENBQUM7SUFBQSxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pKLE9BQU87TUFDTFEsT0FBTyxFQUFFRSxXQUFXO01BQ3BCRCxXQUFXLEVBQUVHO0lBQ2YsQ0FBQztFQUNILENBQUMsQ0FBQztBQUNKIiwiaWdub3JlTGlzdCI6W119